# Обзор проекта (RU)

## 1. Описание проекта

**n8n-image-generator-bot** — это Telegram-бот, созданный на основе платформы автоматизации n8n.  
Он принимает команды пользователей, обрабатывает их через OpenAI (GPT + DALL·E 3) и генерирует:

- текстовые ответы (команда `/start`);
- изображения по описанию (команда `/image <промпт>`).

Бот способен динамически определять команду, корректно реагировать на неизвестные сообщения и отправлять пользователю как текст, так и изображения.

---

## 2. Архитектура workflow

Основной workflow состоит из следующих узлов:

1. **Telegram Trigger**  
   Получает входящие сообщения от Telegram-бота.

2. **PreProcessing**  
   Обрабатывает текст сообщения: извлекает команду, сохраняет текст, формирует действие.

3. **Settings**  
   Определяет параметры модели: температура, длина ответа, системное сообщение, тип действия `typing` или `upload_photo`.

4. **Send a chat action**  
   Отправляет действие в Telegram: индикатор набора текста или загрузки фото.

5. **Merge (chooseBranch)**  
   Объединяет поток обработки.

6. **Switch**  
   Определяет, какую команду отправил пользователь:  
   - `/start`  
   - `/image`  
   - неизвестная команда

7. **Message a model (GPT-4.1-mini)**  
   Генерирует приветственное сообщение по команде `/start`.

8. **Generate an image (DALL·E 3)**  
   Генерирует изображение по текстовому описанию команды `/image`.

9. **Send a text message**  
   Отправляет текстовые сообщения в Telegram.

10. **Send a photo message**  
    Отправляет пользователю изображение по URL.

11. **Fallback (неизвестная команда)**  
    Возвращает сообщение:  
    “Извините, но мы не поддерживаем данный вид команды”.

---

## 3. Логика обработки команд

### Команда `/start`
- Запускает приветственный текст.
- Включает инструкцию по использованию `/image`.

### Команда `/image <описание>`
- Бот принимает текст после команды.
- Передаёт его в DALL·E 3.
- Получает URL готового изображения.
- Отправляет фото пользователю.

### Любая другая команда
- Бот отправляет вежливое сообщение о том, что команда не поддерживается.

---

## 4. Используемые Expressions

Проект активно использует встроенные выражения n8n:

- Получение текста сообщения:  
  `{{ $json.message.text }}`

- Получение chat_id:  
  `{{ $('Telegram Trigger').item.json.message.chat.id }}`

- Определение команды:  
  `{{ $('PreProcessing').item.json.message.text.split(' ')[0] }}`

- Определение состояния бота (typing/upload_photo):  
  `={{ $json.massage.action === '/image' ? 'upload_photo' : 'typing' }}`

---

## 5. Возможности масштабирования

Проект позволяет легко расширять функциональность:

- добавлять inline-кнопки;
- логировать действия в Google Sheets;
- поддерживать голосовые ответы;
- создавать сценарии с несколькими этапами взаимодействия;
- внедрять дополнительные OpenAI-модели.

---

## 6. Требования

- n8n (self-hosted или cloud)
- Telegram Bot API token
- OpenAI API key
- Узлы:
  - Telegram
  - OpenAI (GPT + DALL·E)
  - Switch
  - Merge
  - Set
  - Expression support

---

## 7. Экспорт workflow

Файл workflow находится в:

/workflows/image_generator_telegram_bot.json

Импорт в n8n:

1. Открыть n8n → Import → **From File**.
2. Выбрать файл JSON.
3. Включить workflow.
4. Указать креденшелы Telegram и OpenAI.

---

## 8. Примеры работы

Примеры изображений и скриншоты интерфейса находятся в папке:

/screenshots/


(добавляются вручную после загрузки репозитория)

---
